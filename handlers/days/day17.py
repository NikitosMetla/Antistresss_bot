import asyncio
from aiogram import types, Dispatcher, Router, F, Bot
from aiogram.filters import Text
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import any_state
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder

from db.answers import Answers
from db.users_stat import Users_stat
from handlers.user_handlers import start_LLIC
from settings import InputMessage, sticker_ids
from utils.is_now_day import is_now_day

day_router17 = Router()

@day_router17.callback_query(Text(text="confirm|17"), any_state)
@is_now_day(17)
async def start_day17(message: types.CallbackQuery, state: FSMContext, bot: Bot):
    await message.message.edit_reply_markup()
    await state.clear()
    keyboard = InlineKeyboardBuilder()
    question = await message.message.answer(
        "–ï—Å–ª–∏ —Ç—ã –≤—Å–ø–æ–º–Ω–∏—à—å —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, —Ç–æ —Å–∞–º –ø—Ä–∏–¥–µ—à—å –∫ –≤—ã–≤–æ–¥—É, —á—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî –æ–±—Ä–∞—Ç–∏—Ç—Å—è –∫ –≤—Ä–∞—á—É, —Ç–∞–∫ –∫–∞–∫ —Å—Ç–∞–¥–∏—è –∏—Å—Ç–æ—â–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è —Ü–µ–ª—ã–º —Ä—è–¥–æ–º —Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º."
        " –í–µ—Ä–æ—è—Ç–Ω–æ, —Ç–µ–±–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ñ–∞—Ä–º–∞–∫–æ—Ç–µ—Ä–∞–ø–∏—è –∏–ª–∏ –≤–∏—Ç–∞–º–∏–Ω–æ—Ç–µ—Ä–∞–ø–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µüíä"
        "\n\n–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤—Ä–∞—á —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–¥—ã—Ö. –ò –º—ã —Ç–æ–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º. –ï—Å–ª–∏ –≤ —Ç–∞–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏–¥—Ç–∏ –∫—Ä–∞–π–Ω–µ –º–µ–¥–ª–µ–Ω–Ω–æ, –µ—Å–ª–∏ –≤–æ–æ–±—â–µ –±—É–¥–µ—Ç –∏–¥—Ç–∏‚Ä¶"
        "\n\n–ò –Ω–∞ —ç—Ç–æ–º –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–∫–æ–Ω—á–∏—Ç—å‚Ä¶–Ω–æ –º—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ –Ω–µ —É –≤—Å–µ—Ö –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–≤—Å–µ–º –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º:"
        "\n1. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–µ–¥–ø–∏—Å–∞–Ω–∏—è –≤—Ä–∞—á–∞"
        "\n2. –ù–∞–ª–∞–¥–∏—Ç—å work-life balance ‚Äî –µ—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏/–∏–ª–∏ –Ω–µ —É—á–∏—Ç—å—Å—è —Å–æ–≤—Å–µ–º –∏–∑ –æ–±–ª–∞—Å—Ç–∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∏ (—Ö–æ—Ç—è, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤—Å—ë-—Ç–∞–∫–∏ –≤–æ–∑–º–æ–∂–µ–Ω, –µ—Å–ª–∏ —Ö–æ—Ä–æ—à–æ –ø–æ–¥—É–º–∞—Ç—å), —Ç–æ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏ —á–µ—Ç–∫–æ –µ—ë –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å (—á–µ–ª–æ–≤–µ–∫ –Ω–∞ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ –≤ —Ü–µ–ª–æ–º —É–∂–µ –Ω–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—Ç —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ, –Ω–µ –æ—Å—Ç–∞–≤–ª—è—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ—Ç–¥—ã—Ö)"
        "\n3. –î–µ–ª–∞—Ç—å –≤—Å–µ —Ç–æ, –æ —á–µ–º –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 3 –¥–Ω—è:"
        "\n     ‚Ä¢ –∑–∞–º–µ—á–∞—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω—è—Ç—å/–º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–µ—Å—Å–æ—Ä—ã"
        "\n     ‚Ä¢ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∏—Ç—å–µ–≤–æ–π —Ä–µ–∂–∏–º, —Ä–µ–∂–∏–º—ã –ø–∏—Ç–∞–Ω–∏—è –∏ —Å–Ω–∞"
        "\n     ‚Ä¢ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∏ –≤—ã—Ö–æ–¥–∏—Ç—å –Ω–∞ –ø—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ"
        "\n     ‚Ä¢ —Å–æ–∑–¥–∞—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–æ–º–∞ –∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ"
        "\n     ‚Ä¢ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã"
        "\n     ‚Ä¢ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º —Ç—Ä—É–¥–∞ –∏ –æ—Ç–¥—ã—Ö–∞ –≤ —Ç–µ—á–µ–Ω–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ/—É—á–µ–±–Ω–æ–≥–æ –¥–Ω—è"
        "\n     ‚Ä¢ —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –∏ —Ñ–æ—Ä–º—ã –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–Ω—è—Ç–æ—Å—Ç–∏"
        "\n     ‚Ä¢ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–º—ã—Å–ª —Å–≤–æ–µ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
        "\n     ‚Ä¢ –Ω–∞–ª–∞–¥–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏"
        "\n     ‚Ä¢ –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –Ω–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–∏–≤–Ω–æ—Å–∏—Ç—å –≤ —Å–≤–æ—é –∂–∏–∑–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ –±–æ–ª—å—à–∏–µ —Ä–∞–¥–æ—Å—Ç–∏."
        "\n\n–ü–æ–¥—É–º–∞–π —Å–µ–π—á–∞—Å –∏ –Ω–∞–ø–∏—à–∏, –∫–∞–∫–∏–µ 33 –≤–µ—â–∏/—Å–æ–±—ã—Ç–∏—è/–¥–µ–π—Å—Ç–≤–∏—è/—Ç.–¥. –ø—Ä–∏–Ω–æ—Å—è—Ç —Ç–µ–±–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ ü§î"
    )
    await state.set_state(InputMessage.input_answer_state17_1)
    await state.update_data(question=str(await Users_stat(message.from_user.id).get_user_day()) + ". " + question.text)


@day_router17.message(F.text, InputMessage.input_answer_state17_1)
@is_now_day(17)
async def answer_day17_1(message: types.Message, state: FSMContext, bot: Bot):
    data = await state.get_data()
    question = data.get("question")
    answers = Answers()
    await answers.add_answer(question=question, answer=message.text, user_id=message.from_user.id)
    await state.clear()
    await message.answer_sticker(sticker=sticker_ids[-3])
    keyboard = InlineKeyboardBuilder()
    keyboard.row(InlineKeyboardButton(text="–î–∞! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª–∏", callback_data="YES|17"))
    keyboard.row(InlineKeyboardButton(text="–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–±—ã–≤–∞—é —Å–µ–±—è —Ä–∞–¥–æ–≤–∞—Ç—åüòÑ", callback_data="YES|17"))
    await message.answer("–ï—Å—Ç—å —á—Ç–æ-—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞, —á—Ç–æ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –ø—Ä–∏–≤–Ω–µ—Å—Ç–∏ –≤ –∂–∏–∑–Ω—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è?", reply_markup=keyboard.as_markup())


@day_router17.callback_query(Text(text="YES|17"))
@is_now_day(17)
async def end_day17(message: types.CallbackQuery, state: FSMContext, bot: Bot):
    await message.message.answer("–û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –µ—â—ë –æ—Å—Ç–∞–ª–∏—Å—å –º–µ—Ç–æ–¥—ã –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –æ –Ω–∏—Ö –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –≤ –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏ üòâ")
    await message.message.answer("–ù–∞ —Å–µ–≥–æ–¥–Ω—è –≤—Å–µüëê")
    await Users_stat(message.from_user.id).edit_user_end_day()